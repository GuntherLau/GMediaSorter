# 时长过滤逻辑调整说明

## 变更日期: 2025-10-22

## 变更原因

用户反馈：选择"2分钟内"时不应该包含"30秒内"的视频，各档位应该是互斥的区间。

## 逻辑对比

### ❌ 旧逻辑（累积式）

档位之间有重叠，选择一个档位会包含所有更小的视频：

```
30秒内:    |████████|
2分钟内:   |████████████████████████████████████|  ← 包含30秒内
10分钟内:  |████████████████████████████████████████████████████████████████████| ← 包含30秒和2分钟
```

**问题示例**:
- 选择"2分钟内"，会看到所有 ≤ 120秒的视频（包括10秒、20秒的）
- 选择"10分钟内"，会看到所有 ≤ 600秒的视频（包括30秒、2分钟的）

### ✅ 新逻辑（区间互斥）

各档位之间完全独立，互不重叠：

```
30秒内:         |████████|
30秒-2分钟:              |████████████████████|
2-10分钟:                                     |████████████████████████████|
10-30分钟:                                                                   |████████████|
30分钟-1小时:                                                                             |████████|
超过1小时:                                                                                        |████→
```

**改进效果**:
- 选择"30秒-2分钟"，只看到 30秒 < duration ≤ 120秒 的视频
- 选择"2-10分钟"，只看到 120秒 < duration ≤ 600秒 的视频
- 各档位互不干扰，符合直觉

## 具体变更

### 1. 类型定义变更

**文件**: `src/types.ts`

```diff
export type DurationPreset = 
  | 'lte30s'       // ≤ 30秒
- | 'lte2m'        // ≤ 2分钟
- | 'lte10m'       // ≤ 10分钟
- | 'lte30m'       // ≤ 30分钟
- | 'lte1h'        // ≤ 1小时
+ | 'range30s2m'   // 30秒 < duration ≤ 2分钟
+ | 'range2m10m'   // 2分钟 < duration ≤ 10分钟
+ | 'range10m30m'  // 10分钟 < duration ≤ 30分钟
+ | 'range30m1h'   // 30分钟 < duration ≤ 1小时
  | 'gt1h';        // > 1小时
```

### 2. 配置文案变更

**文件**: `src/config/filters.ts`

```diff
options: [
  { value: 'all', label: '全部' },
  { value: 'lte30s', label: '30秒内' },
- { value: 'lte2m', label: '2分钟内' },
- { value: 'lte10m', label: '10分钟内' },
- { value: 'lte30m', label: '30分钟内' },
- { value: 'lte1h', label: '1小时内' },
+ { value: 'range30s2m', label: '30秒-2分钟' },
+ { value: 'range2m10m', label: '2-10分钟' },
+ { value: 'range10m30m', label: '10-30分钟' },
+ { value: 'range30m1h', label: '30分钟-1小时' },
  { value: 'gt1h', label: '超过1小时' },
]
```

### 3. 过滤逻辑变更

**文件**: `src/utils/filters.ts`

```diff
switch (filter) {
  case 'lte30s':
    return duration <= 30;
  
- case 'lte2m':
-   return duration <= 120;
+ case 'range30s2m':
+   return duration > 30 && duration <= 120;  // 区间判断
  
- case 'lte10m':
-   return duration <= 600;
+ case 'range2m10m':
+   return duration > 120 && duration <= 600;  // 区间判断
  
- case 'lte30m':
-   return duration <= 1800;
+ case 'range10m30m':
+   return duration > 600 && duration <= 1800;  // 区间判断
  
- case 'lte1h':
-   return duration <= 3600;
+ case 'range30m1h':
+   return duration > 1800 && duration <= 3600;  // 区间判断
  
  case 'gt1h':
    return duration > 3600;
}
```

## 使用示例

### 示例1: 查找短视频

**需求**: 找出30秒到2分钟的短视频（不包括超短片段）

**旧方式**:
- 选择"2分钟内" → 会包含10秒、20秒的片段 ❌
- 需要手动排除

**新方式**:
- 直接选择"30秒-2分钟" → 精确匹配 ✅

### 示例2: 查找中等长度视频

**需求**: 找出2-10分钟的视频

**旧方式**:
- 选择"10分钟内" → 会包含30秒、1分钟的视频 ❌
- 无法精确筛选

**新方式**:
- 直接选择"2-10分钟" → 精确匹配 ✅

## 档位说明

| 档位名称 | 时长范围 | 典型用途 | 示例 |
|---------|---------|---------|------|
| **30秒内** | 0 - 30秒 | 超短视频、片段 | 短视频片段、GIF |
| **30秒-2分钟** | 30秒 - 2分钟 | 短视频、音乐MV | TikTok、音乐视频 |
| **2-10分钟** | 2分钟 - 10分钟 | 中短视频 | YouTube短视频、预告片 |
| **10-30分钟** | 10分钟 - 30分钟 | 中长视频 | 电视剧单集、教学视频 |
| **30分钟-1小时** | 30分钟 - 1小时 | 长视频 | 纪录片、电影 |
| **超过1小时** | 1小时以上 | 超长视频 | 长片电影、直播回放 |

## 测试场景

### 测试数据

假设有以下视频文件：
- video1.mp4: 15秒
- video2.mp4: 45秒
- video3.mp4: 3分钟 (180秒)
- video4.mp4: 15分钟 (900秒)
- video5.mp4: 45分钟 (2700秒)
- video6.mp4: 2小时 (7200秒)

### 预期结果

| 选择档位 | 应该显示的视频 | 不应该显示的视频 |
|---------|---------------|-----------------|
| 全部 | 全部6个 | 无 |
| 30秒内 | video1 (15秒) | video2, 3, 4, 5, 6 |
| 30秒-2分钟 | video2 (45秒) | video1, 3, 4, 5, 6 |
| 2-10分钟 | video3 (3分钟) | video1, 2, 4, 5, 6 |
| 10-30分钟 | video4 (15分钟) | video1, 2, 3, 5, 6 |
| 30分钟-1小时 | video5 (45分钟) | video1, 2, 3, 4, 6 |
| 超过1小时 | video6 (2小时) | video1, 2, 3, 4, 5 |

## 向后兼容性

⚠️ **重要**: 此变更**不向后兼容**

- 类型名称已改变 (`lte2m` → `range30s2m`)
- 过滤逻辑已改变（累积 → 区间）
- 用户界面标签已更新

如果有保存的过滤器配置，需要迁移到新的档位名称。

## 文档更新

以下文档已同步更新：
- ✅ `src/types.ts` - 类型定义
- ✅ `src/config/filters.ts` - 配置和文案
- ✅ `src/utils/filters.ts` - 过滤逻辑
- ✅ `docs/video-duration-filter-plan.md` - 设计文档
- ✅ `docs/DURATION_FILTER_CHANGELOG.md` - 变更日志
- ✅ `docs/DURATION_FILTER_LOGIC_CHANGE.md` - 本文档（新建）

## 总结

此次变更让时长过滤器更加符合用户直觉：

✅ **优点**:
1. 各档位互不重叠，逻辑清晰
2. 文案直接表达区间范围
3. 更精确的视频筛选
4. 符合用户期望

⚠️ **注意**:
1. 不向后兼容
2. 需要重新选择过滤条件
3. 类型名称已变更

---

**变更人**: GMediaSorter Team
**审核人**: 待审核  
**状态**: 已实施，待测试
